// --- PREGUNTAS ---
const preguntas = [
  {
  texto: "En quin any es va fundar el Club de Roma?",
  opciones: [
    "a) 1960",
    "b) 1968",
    "c) 1973",
    "d) 1987"
  ],
  correcta: "b"
},
{
  texto: "Quin informe va publicar el Club de Roma?",
  opciones: [
    "a) Informe Brundtland",
    "b) Informe Meadows",
    "c) Agenda 21",
    "d) Protocol de Kyoto"
  ],
  correcta: "b"
},
{
  texto: "Quin any es va celebrar el primer Dia de la Terra?",
  opciones: [
    "a) 1965",
    "b) 1970",
    "c) 1980",
    "d) 1992"
  ],
  correcta: "b"
},
{
  texto: "Quina agència es va crear arran del primer Dia de la Terra?",
  opciones: [
    "a) FAO",
    "b) ONU",
    "c) EPA",
    "d) UE"
  ],
  correcta: "c"
},
{
  texto: "Quin any es va aprovar el Primer Programa d’Acció Comunitària sobre el Medi Ambient?",
  opciones: [
    "a) 1968",
    "b) 1973",
    "c) 1980",
    "d) 1992"
  ],
  correcta: "b"
},
{
  texto: "Quin informe defineix per primera vegada el concepte de desenvolupament sostenible?",
  opciones: [
    "a) Informe Meadows",
    "b) Informe Brundtland",
    "c) Agenda 21",
    "d) Protocol de Kyoto"
  ],
  correcta: "b"
},
{
  texto: "On es va celebrar la Conferència de les Nacions Unides sobre Medi Ambient i Desenvolupament de 1992?",
  opciones: [
    "a) Kyoto",
    "b) París",
    "c) Mont-real",
    "d) Rio de Janeiro"
  ],
  correcta: "d"
},
{
  texto: "Quin lema s’associa a l’Agenda 21?",
  opciones: [
    "a) Pensa global, actua local",
    "b) Salvem el planeta",
    "c) Creixement verd",
    "d) Futur sostenible"
  ],
  correcta: "a"
},
{
  texto: "Quin reglament europeu sobre medi ambient es va crear el 1995?",
  opciones: [
    "a) EMAS",
    "b) ISO 14000",
    "c) REACH",
    "d) Ecolabel"
  ],
  correcta: "a"
},
{
  texto: "Quan es van publicar les normes ISO 14000?",
  opciones: [
    "a) 1987",
    "b) 1996",
    "c) 2005",
    "d) 2015"
  ],
  correcta: "b"
},
{
  texto: "Quin és l’objectiu principal del Protocol de Kyoto?",
  opciones: [
    "a) Reduir les emissions de gasos d’efecte hivernacle",
    "b) Eliminar els CFC",
    "c) Fomentar el reciclatge mundial",
    "d) Restaurar la capa d’ozó"
  ],
  correcta: "a"
},
{
  texto: "Quin país va permetre que el Protocol de Kyoto entrés en vigor?",
  opciones: [
    "a) Estats Units",
    "b) Rússia",
    "c) Xina",
    "d) Espanya"
  ],
  correcta: "b"
},
{
  texto: "En quin any va entrar en vigor el Protocol de Kyoto?",
  opciones: [
    "a) 1997",
    "b) 2000",
    "c) 2005",
    "d) 2012"
  ],
  correcta: "c"
},
{
  texto: "A quin percentatge de reducció global d’emissions aspirava el Protocol de Kyoto?",
  opciones: [
    "a) 2%",
    "b) 5%",
    "c) 8%",
    "d) 10%"
  ],
  correcta: "b"
},
{
  texto: "Quin any es va celebrar la Cimera Mundial sobre Desenvolupament Sostenible?",
  opciones: [
    "a) 2000",
    "b) 2002",
    "c) 2005",
    "d) 2015"
  ],
  correcta: "b"
},
{
  texto: "Quin acord internacional es va proposar el 2015 per limitar l’augment de temperatura global?",
  opciones: [
    "a) Acord de París",
    "b) Agenda 21",
    "c) Protocol de Montreal",
    "d) Conferència de Kyoto"
  ],
  correcta: "a"
},
{
  texto: "Quin és l’objectiu principal de l’Acord de París?",
  opciones: [
    "a) Limitar l’augment de temperatura global per sota dels 2ºC",
    "b) Eliminar els residus plàstics",
    "c) Reduir la contaminació de l’aigua",
    "d) Fomentar l’economia circular"
  ],
  correcta: "a"
},
{
  texto: "Quin fenomen és causat per compostos que contenen clor i brom com els CFC?",
  opciones: [
    "a) Escalfament global",
    "b) Deteriorament de la capa d’ozó",
    "c) Eutrofització",
    "d) Acidificació"
  ],
  correcta: "b"
},
{
  texto: "En quin protocol es van prohibir els CFC?",
  opciones: [
    "a) Montreal",
    "b) Kyoto",
    "c) París",
    "d) Rio"
  ],
  correcta: "a"
},
{
  texto: "Quina és una conseqüència del deteriorament de la capa d’ozó?",
  opciones: [
    "a) Càncer de pell i cataractes",
    "b) Reducció del CO₂ atmosfèric",
    "c) Disminució de radiació ultraviolada",
    "d) Augment de la pluja àcida"
  ],
  correcta: "a"
},
{
  texto: "Què és l’escalfament global?",
  opciones: [
    "a) Un procés natural de refredament del planeta",
    "b) L’augment gradual de la temperatura de la Terra causat per l’activitat humana",
    "c) Una disminució de la radiació solar que arriba a la Terra",
    "d) L’augment de l’albedo terrestre"
  ],
  correcta: "b"
},
{
  texto: "Quin gas contribueix principalment a l’efecte hivernacle?",
  opciones: [
    "a) O₂",
    "b) N₂",
    "c) CO₂",
    "d) H₂"
  ],
  correcta: "c"
},
{
  texto: "Quina és una conseqüència directa de l’escalfament global?",
  opciones: [
    "a) Descens del nivell del mar",
    "b) Increment de fenòmens meteorològics extrems",
    "c) Augment de la capa d’ozó",
    "d) Disminució de la temperatura mitjana global"
  ],
  correcta: "b"
},
{
  texto: "Què causa l’acidificació del medi?",
  opciones: [
    "a) Emissions de CFC",
    "b) Emissions de SO₂ i NOx",
    "c) Emissions de metà",
    "d) Escalfament global"
  ],
  correcta: "b"
},
{
  texto: "Quina característica té la pluja àcida?",
  opciones: [
    "a) Té un pH alt (bàsic)",
    "b) Té un pH baix (àcid)",
    "c) Té un pH neutre (7)",
    "d) No afecta el medi natural"
  ],
  correcta: "b"
},
{
  texto: "Què és l’eutrofització?",
  opciones: [
    "a) Acumulació de nutrients en ecosistemes aquàtics",
    "b) Reducció del nivell de nutrients al sòl",
    "c) Generació de smog urbà",
    "d) Erosió del terreny"
  ],
  correcta: "a"
},
{
  texto: "Quina és una conseqüència de l’eutrofització?",
  opciones: [
    "a) Augment de la biodiversitat",
    "b) Olor desagradable i pèrdua de vida aquàtica",
    "c) Reducció de la pluja àcida",
    "d) Disminució de la temperatura de l’aigua"
  ],
  correcta: "b"
},
{
  texto: "Com s’anomena la boira contaminant formada per òxids i partícules?",
  opciones: [
    "a) Smog",
    "b) Eutrofització",
    "c) Pluja àcida",
    "d) Ozó troposfèric"
  ],
  correcta: "a"
},
{
  texto: "Quins efectes provoca l’smog en la salut humana?",
  opciones: [
    "a) Irritació ocular i respiratòria",
    "b) Hipotèrmia",
    "c) Augment de la pressió arterial",
    "d) Pèrdua d’audició"
  ],
  correcta: "a"
},
{
  texto: "Què és l’ecotoxicitat?",
  opciones: [
    "a) Impacte de substàncies químiques sobre els ecosistemes",
    "b) Contaminació acústica",
    "c) Efecte hivernacle",
    "d) Increment de la radiació solar"
  ],
  correcta: "a"
},
{
  texto: "Quins compostos contribueixen principalment a la toxicitat humana?",
  opciones: [
    "a) Metalls pesants i compostos orgànics persistents (COP)",
    "b) Aigua destil·lada i oxigen",
    "c) Gasos nobles i nitrogen",
    "d) Compostos aromàtics volàtils naturals"
  ],
  correcta: "a"
},
{
  texto: "Quin és el gas més greu emès pels abocadors?",
  opciones: [
    "a) Metà (CH₄)",
    "b) Diòxid de carboni (CO₂)",
    "c) Ozó (O₃)",
    "d) Diòxid de sofre (SO₂)"
  ],
  correcta: "a"
},
{
  texto: "Què són els lixiviats?",
  opciones: [
    "a) Líquids que drenen dels abocadors i contaminen aigües subterrànies",
    "b) Gasos de combustió industrial",
    "c) Compostos utilitzats per purificar l’aigua",
    "d) Partícules sòlides reciclades"
  ],
  correcta: "a"
},
{
  texto: "Quina és una de les causes de l’esgotament dels recursos naturals?",
  opciones: [
    "a) Sobreconsum i ús excessiu de recursos no renovables",
    "b) Disminució de la població mundial",
    "c) Augment de la biodiversitat",
    "d) Creació de reserves naturals"
  ],
  correcta: "a"
},
{
  texto: "Quina és una conseqüència directa de la sobrepoblació?",
  opciones: [
    "a) Augment de la demanda de recursos naturals",
    "b) Disminució del consum energètic",
    "c) Millora de la qualitat de l’aire",
    "d) Reducció dels residus generats"
  ],
  correcta: "a"
},
{
  texto: "Quina d’aquestes NO és una causa de l’esgotament de recursos?",
  opciones: [
    "a) Sobreconsum",
    "b) Desenvolupament industrial",
    "c) Distribució equitativa de recursos",
    "d) Sobrepoblació"
  ],
  correcta: "c"
},
{
  texto: "Quin any es van proposar els Objectius de Desenvolupament Sostenible (ODS)?",
  opciones: [
    "a) 2010",
    "b) 2012",
    "c) 2015",
    "d) 2020"
  ],
  correcta: "c"
},
{
  texto: "Quin any es va publicar el 8è Programa d’Acció Ambiental de la Unió Europea?",
  opciones: [
    "a) 2015",
    "b) 2020",
    "c) 2022",
    "d) 2024"
  ],
  correcta: "c"
},
{
  texto: "Quin és l’objectiu climàtic de la Unió Europea per a l’any 2030 segons el 8è Programa d’Acció Ambiental?",
  opciones: [
    "a) Reduir les emissions un 25%",
    "b) Reduir les emissions un 55% respecte als nivells de 1990",
    "c) Reduir les emissions un 75%",
    "d) Neutralitat climàtica total"
  ],
  correcta: "b"
},
{
  texto: "Quin és l’objectiu principal de la Unió Europea per a l’any 2050 segons el 8è Programa d’Acció Ambiental?",
  opciones: [
    "a) Aconseguir la neutralitat climàtica",
    "b) Reduir les emissions un 25%",
    "c) Eliminar tots els residus industrials",
    "d) Augmentar les emissions de CO₂ per sobre del 1990"
  ],
  correcta: "a"
},
{
  texto: "Qui va dirigir l’informe 'Els Límits del Creixement' del Club de Roma?",
  opciones: [
    "a) Donella Meadows",
    "b) Rachel Carson",
    "c) Al Gore",
    "d) Jane Goodall"
  ],
  correcta: "a"
},
{
  texto: "Quina era la conclusió principal de l’informe 'Els Límits del Creixement'?",
  opciones: [
    "a) Que el creixement econòmic il·limitat no és sostenible a llarg termini",
    "b) Que els recursos naturals són infinits",
    "c) Que la contaminació no tenia impacte significatiu",
    "d) Que el progrés tecnològic resol tots els problemes ambientals"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va publicar l’Informe Brundtland?",
  opciones: [
    "a) 1980",
    "b) 1987",
    "c) 1992",
    "d) 1997"
  ],
  correcta: "b"
},
{
  texto: "Com es titulava l’Informe Brundtland de 1987?",
  opciones: [
    "a) El nostre futur comú",
    "b) Els límits del creixement",
    "c) Futur sostenible",
    "d) Un món verd"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va celebrar la Cimera de la Terra a Rio de Janeiro?",
  opciones: [
    "a) 1987",
    "b) 1990",
    "c) 1992",
    "d) 2000"
  ],
  correcta: "c"
},
{
  texto: "Quin document va sorgir de la Cimera de Rio de 1992 per promoure el desenvolupament sostenible local?",
  opciones: [
    "a) L’Agenda 21",
    "b) El Protocol de Kyoto",
    "c) L’Informe Meadows",
    "d) L’Acord de París"
  ],
  correcta: "a"
},
{
  texto: "Quina és la frase associada a l’Agenda 21?",
  opciones: [
    "a) Think global, act local",
    "b) Save the Earth",
    "c) One planet, one future",
    "d) Protect our nature"
  ],
  correcta: "a"
},
{
  texto: "En quin any es va aprovar el Primer Programa d’Acció Ambiental de la Comunitat Europea?",
  opciones: [
    "a) 1973",
    "b) 1980",
    "c) 1987",
    "d) 1995"
  ],
  correcta: "a"
},
{
  texto: "Quin és l’objectiu dels Programes d’Acció Ambiental de la UE?",
  opciones: [
    "a) Establir les prioritats ambientals de la política europea per períodes concrets",
    "b) Substituir la legislació ambiental estatal",
    "c) Regular el comerç d’energia renovable",
    "d) Controlar el mercat del CO₂"
  ],
  correcta: "a"
},
{
  texto: "Quan es va adoptar el Protocol de Kyoto?",
  opciones: [
    "a) 1992",
    "b) 1995",
    "c) 1997",
    "d) 2005"
  ],
  correcta: "c"
},
{
  texto: "Quin era l’objectiu principal del Protocol de Kyoto?",
  opciones: [
    "a) Reduir les emissions de gasos d’efecte hivernacle",
    "b) Prohibir els aerosols",
    "c) Reduir la contaminació acústica",
    "d) Promoure el comerç internacional"
  ],
  correcta: "a"
},
{
  texto: "Quan va entrar en vigor el Protocol de Kyoto?",
  opciones: [
    "a) 1997",
    "b) 2000",
    "c) 2005",
    "d) 2010"
  ],
  correcta: "c"
},
{
  texto: "Quin país va permetre que el Protocol de Kyoto entrés en vigor en ratificar-lo?",
  opciones: [
    "a) Estats Units",
    "b) Rússia",
    "c) Espanya",
    "d) Xina"
  ],
  correcta: "b"
},
{
  texto: "Quan es va signar l’Acord de París sobre el clima?",
  opciones: [
    "a) 2005",
    "b) 2012",
    "c) 2015",
    "d) 2018"
  ],
  correcta: "c"
},
{
  texto: "Quin és l’objectiu principal de l’Acord de París (2015)?",
  opciones: [
    "a) Limitar l’augment de la temperatura global per sota dels 2 °C",
    "b) Reduir el consum d’aigua potable",
    "c) Prohibir els combustibles fòssils",
    "d) Controlar la contaminació acústica"
  ],
  correcta: "a"
},
{
  texto: "Quina és la diferència principal entre el Protocol de Kyoto i l’Acord de París?",
  opciones: [
    "a) Kyoto establia objectius vinculants per països desenvolupats; París fixa compromisos voluntaris per tots",
    "b) Kyoto tractava la biodiversitat; París tracta només residus",
    "c) París només s’aplica a la UE",
    "d) Kyoto és posterior a París"
  ],
  correcta: "a"
},
{
  texto: "Quina és la causa principal de la problemàtica ambiental actual?",
  opciones: [
    "a) El model de producció i consum insostenible",
    "b) L’augment de la població mundial",
    "c) El canvi climàtic natural",
    "d) La rotació de la Terra"
  ],
  correcta: "a"
},
{
  texto: "Quin tipus de relació hi ha entre desenvolupament econòmic i medi ambient segons la visió clàssica?",
  opciones: [
    "a) De conflicte, ja que el creixement sol generar més pressió ambiental",
    "b) De complementarietat absoluta",
    "c) Cap relació directa",
    "d) El medi ambient impulsa sempre el creixement"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va crear el Programa de Nacions Unides per al Medi Ambient (PNUMA)?",
  opciones: [
    "a) 1970",
    "b) 1972",
    "c) 1980",
    "d) 1987"
  ],
  correcta: "b"
},
{
  texto: "Quin va ser el lema de la Conferència d’Estocolm (1972)?",
  opciones: [
    "a) Only One Earth",
    "b) Think global, act local",
    "c) Save our planet",
    "d) Our common future"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va celebrar la Cimera Mundial sobre Desenvolupament Sostenible a Johannesburg?",
  opciones: [
    "a) 1997",
    "b) 2000",
    "c) 2002",
    "d) 2005"
  ],
  correcta: "c"
},
{
  texto: "Quin va ser l’objectiu principal de la Cimera de Johannesburg (2002)?",
  opciones: [
    "a) Revisar i reforçar l’aplicació de l’Agenda 21",
    "b) Reduir les emissions industrials",
    "c) Crear el Protocol de Kyoto",
    "d) Definir l’Acord de París"
  ],
  correcta: "a"
},
{
  texto: "Quin any es va aprovar el VI Programa d’Acció Ambiental de la UE?",
  opciones: [
    "a) 1998",
    "b) 2001",
    "c) 2005",
    "d) 2010"
  ],
  correcta: "b"
},
{
  texto: "Quins eren els àmbits prioritaris del VI Programa d’Acció Ambiental?",
  opciones: [
    "a) Canvi climàtic, biodiversitat, medi ambient i salut, i recursos naturals",
    "b) Energia, transport, indústria i comerç",
    "c) Agricultura, pesca i turisme",
    "d) Innovació, digitalització i economia"
  ],
  correcta: "a"
},
{
  texto: "Quina és la durada del VI Programa d’Acció Ambiental de la UE?",
  opciones: [
    "a) 2001–2010",
    "b) 2005–2015",
    "c) 1990–2000",
    "d) 2012–2020"
  ],
  correcta: "a"
},
{
  texto: "Quin és el títol del VII Programa d’Acció Ambiental de la UE?",
  opciones: [
    "a) Viure bé dins els límits del nostre planeta",
    "b) Un futur comú sostenible",
    "c) Europa 2030 verda",
    "d) Medi ambient i progrés econòmic"
  ],
  correcta: "a"
},
{
  texto: "Quin any va començar el Pacte Verd Europeu (Green Deal)?",
  opciones: [
    "a) 2015",
    "b) 2019",
    "c) 2020",
    "d) 2022"
  ],
  correcta: "b"
},
{
  texto: "Quin principi ambiental estableix que 'qui contamina, paga'?",
  opciones: [
    "a) Principi de responsabilitat ambiental",
    "b) Principi de precaució",
    "c) Principi de subsidiarietat",
    "d) Principi de correcció en origen"
  ],
  correcta: "a"
},
{
  texto: "Quin principi promou actuar abans que hi hagi danys irreversibles al medi?",
  opciones: [
    "a) Principi de precaució",
    "b) Principi de recuperació",
    "c) Principi de reparació",
    "d) Principi de subsidiarietat"
  ],
  correcta: "a"
}
];
// --- FRASES DE ÁNIMO ---
const frases_animo = [
  "¡Muy bien! 😎",
  "¡Eso es, perfecto, te camelo caramelo! 🔥",
  "¡Ole tú huevos! 💪",
  "¡Exacto, estás on fire! 🚀",
  "¡Qué máquina eres! 😍",
  "¡Correcto, así se hace! 👏",
  "¡Te lo sabes de memoria ya! 💥"
];

// --- VARIABLES ---
let i = 0;
let puntuacion = 0;
let preguntasParaEsteTest = [];

// --- FUNCIONES ---

/**
 * Baraja un array aleatoriamente (algoritmo Fisher-Yates).
 * @param {Array} array El array a barajar.
 */
function barajarPreguntas(array) {
  let currentIndex = array.length,  randomIndex;

  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }
  return array;
}

/**
 * Muestra un mensaje en el chat.
 * @param {string} texto El contenido del mensaje.
 * @param {string} tipo 'bot' o 'user'.
 */
function mostrarMensaje(texto, tipo) {
  const chat = document.getElementById("chat");
  const msg = document.createElement("div");
  msg.classList.add("message", tipo);
  // Convierte los saltos de línea (\n) en etiquetas <br>
  msg.innerHTML = texto.replace(/\n/g, "<br>");
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

/**
 * Muestra la pregunta actual y sus opciones en un solo mensaje.
 */
function mostrarPregunta() {
  // Usa el array de 20 preguntas
  if (!preguntasParaEsteTest[i]) return;

  const p = preguntasParaEsteTest[i];
  // Une la pregunta y las opciones en un solo texto
  const textoCompleto = `${p.texto}\n\n${p.opciones.join("\n")}`;
  mostrarMensaje(textoCompleto, "bot");
}

/**
 * Procesa la respuesta del usuario.
 * @param {string} opcionElegida "a", "b", "c" o "d".
 */
function responder(opcionElegida) {
  // Usa el array de 20 preguntas
  if (!preguntasParaEsteTest[i]) return;

  const p = preguntasParaEsteTest[i];
  // Muestra solo la letra, como pediste
  mostrarMensaje(`${opcionElegida.toUpperCase()}`, "user");

  if (opcionElegida === p.correcta) {
    puntuacion++;
    mostrarMensaje(frases_animo[Math.floor(Math.random() * frases_animo.length)], "bot");
  } else {
    mostrarMensaje(`❌ Incorrecto. La respuesta correcta era ${p.correcta.toUpperCase()}.`, "bot");
  }

  i++;
  // Comprueba si quedan preguntas en el array de 20
  if (i < preguntasParaEsteTest.length) {
    setTimeout(mostrarPregunta, 800);
  } else {
    setTimeout(() => {
      // Muestra la puntuación final sobre 20 (o el total que haya)
      mostrarMensaje(`🏁 Has acertado ${puntuacion} de ${preguntasParaEsteTest.length} preguntas. 💡`, "bot");
      desactivarBotones();
    }, 800);
  }
}

/**
 * Desactiva los botones de opción al final del test.
 */
function desactivarBotones() {
  document.querySelectorAll(".btn-opcion").forEach(btn => btn.disabled = true);
}

// --- ARRANQUE ---
document.addEventListener("DOMContentLoaded", () => {
  i = 0;
  puntuacion = 0;
  
  // 1. Barajamos TODO el array de preguntas
  barajarPreguntas(preguntas); 
  
  // 2. Nos quedamos solo con las 20 primeras (o menos, si el array es más corto)
  preguntasParaEsteTest = preguntas.slice(0, 20); 

  mostrarMensaje(`🧠 Bienvenido al test. Se han elegido ${preguntasParaEsteTest.length} preguntas al azar. 💬`, "bot");
  setTimeout(mostrarPregunta, 500);

  document.getElementById("btnA").onclick = () => responder("a");
  document.getElementById("btnB").onclick = () => responder("b");
  document.getElementById("btnC").onclick = () => responder("c");
  document.getElementById("btnD").onclick = () => responder("d");
});





